/**
 * =======================================+
 * ANAVO TECH - UNIVERSAL LICENSING SYSTEM
 * =======================================+
 * Used by ALL Anavo Tech Squarespace plugins
 * @version 1.1.0
 * @author Anavo Tech
 * @copyright 2026 Anavo Tech.  All rights reserved.
 * 
 * CDN:  https://cdn.jsdelivr.net/gh/clonegarden/squarespaceplugins@latest/_shared/licensing.min.js
 * 
 * CHANGELOG v1.1.0:
 * - Made truly universal (no plugin-specific references)
 * - Separated license logic from UI rendering
 * - Plugins now handle their own watermarks
 * ========================================
 */
!function(e){"use strict";e.AnavoLicenseManager=class AnavoLicenseManager{constructor(e,s,i={}){this.pluginName=e,this.version=s,this.licenseServer=i.licenseServer||"https://anavotech.com/api/licenses. json",this.checkInterval=i.checkInterval||36e5,this.showUI=!1!==i.showUI,this.cachedLicense=null,this.isLicensed=!1,this.licenseType=null,this.bypassDomains=["shallot-cone-9wym.squarespace.com","anavo. tech","www.anavo.tech"]}async init(){if(console.log(`üîê ${this.pluginName} v${this.version} - Checking license...`),this.isBypassDomain())return console.log("üîì Bypass domain - Full access granted"),this.isLicensed=!0,this.licenseType="bypass",{licensed:!0,type:"bypass"};if(this.isDevelopment())return console.log("üîß Development mode - Running with watermark"),this.isLicensed=!1,this.licenseType="development",{licensed:!1,type:"development"};const e=await this.checkLicense();return e.licensed?(console.log(`‚úÖ License verified - ${e.type} license`),this.setupPeriodicCheck()):(console.warn("‚ö†Ô∏è No valid license - Running in limited mode"),this.showUI&&this.showLicenseNotice()),e}isBypassDomain(){const s=e.location.hostname.toLowerCase();return this.bypassDomains.some(e=>s===e.toLowerCase()||s.endsWith("."+e.toLowerCase()))}isDevelopment(){const s=e.location.hostname.toLowerCase();return["localhost","127.0.0.1",". local",".sqsp.com",".squarespace.com","staging-"].some(e=>e.startsWith(". ")?s.endsWith(e)||s.includes(e):s===e||s.startsWith(e))}async checkLicense(){try{const e=await fetch(this.licenseServer,{method:"GET",cache:"no-cache",headers:{Accept:"application/json"}});if(!e.ok)throw new Error("License server unavailable");const s=await e.json();return this.cachedLicense=s,this.validateDomain(s)}catch(e){return console.error("License check failed:",e.message),{licensed:!1,type:"offline"}}}validateDomain(s){const i=e.location.hostname.toLowerCase(),n=s.licenses[this.pluginName];if(n&&this.matchesDomain(i,n.allowed_domains)){if(n.expires){if(new Date(n.expires)<new Date)return{licensed:!1,type:"expired"}}return this.isLicensed=!0,this.licenseType=n.license_type,{licensed:!0,type:n.license_type,features:n.features}}return this.matchesDomain(i,s.global_whitelist)?(this.isLicensed=!1,this.licenseType="development",{licensed:!1,type:"development"}):{licensed:!1,type:"none"}}matchesDomain(e,s){return!!s&&s.some(s=>{if(s===e)return!0;if(s.startsWith("*.")){const i=s.slice(2);return e.endsWith(i)||e===i}if(s.includes("*")){return new RegExp("^"+s.replace(/\*/g,".*")+"$").test(e)}return!1})}setupPeriodicCheck(){setInterval(()=>{this.isBypassDomain()||this.checkLicense().then(s=>{!s.licensed&&this.isLicensed&&(console.warn("‚ö†Ô∏è License status changed"),e.location.reload())})},this.checkInterval)}showLicenseNotice(){if(document.getElementById("anavo-license-notice"))return;const e=document.createElement("div");e.id="anavo-license-notice",e.innerHTML=`\n        <div style="position: fixed;bottom:20px;right:20px;background: rgba(0,0,0,0.9);color:#fff;padding:15px 20px;border-radius:8px;font-family:system-ui,sans-serif;font-size:13px;z-index:999999;box-shadow:0 4px 12px rgba(0,0,0,0.3);max-width:300px">\n          <div style="font-weight:700;margin-bottom:8px">‚ö†Ô∏è Unlicensed Plugin</div>\n          <div style="margin-bottom:12px;line-height:1.4">\n            The <strong>${this.pluginName}</strong> plugin requires a license. \n          </div>\n          <a href="https://anavotech.com/plugins/${this.pluginName}" target="_blank" style="display:inline-block;background:#fff;color:#000;padding:8px 16px;border-radius:4px;text-decoration:none;font-weight: 600;font-size:12px">\n            Get License ‚Üí\n          </a>\n        </div>\n      `,document.body.appendChild(e)}createWatermark(){const e=document.createElement("div");return e.className="anavo-watermark",e.style.cssText="position:relative;width:100%;text-align:center;padding:20px;background:#fff3cd;border: 2px dashed #ffc107;border-radius:8px;margin: 20px 0;font-family:system-ui,sans-serif;box-sizing:border-box",e.innerHTML='\n        <strong style="color:#856404">‚ö†Ô∏è Unlicensed Version</strong><br>\n        <span style="font-size:14px;color:#856404">\n          Purchase a license to remove this notice.\n        </span>\n      ',e}insertWatermark(e){const s="string"==typeof e?document.getElementById(e):e;if(s&&!this.isLicensed){const e=this.createWatermark();s.insertBefore(e,s.firstChild)}}hasFeature(e){if(this.isBypassDomain())return!0;if(!this.isLicensed)return!1;if(!this.cachedLicense)return!1;const s=this.cachedLicense.licenses[this.pluginName];return!s||!s.features||s.features.includes(e)}restrictFeature(e,s){this.hasFeature(e)?s():alert("This feature requires a licensed version.\n\nGet your license at: https://anavotech.com/plugins")}getStatus(){return{licensed:this.isLicensed,type:this.licenseType,pluginName:this.pluginName,version:this.version,features:this.cachedLicense?.licenses?.[this.pluginName]?.features||[]}}}}(window);