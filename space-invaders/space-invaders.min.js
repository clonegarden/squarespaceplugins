!function(){"use strict";const n="1.0.0";console.log(`üéÆ Space Invaders Plugin v${n} - Loading...`);const e=document.currentScript||function(){const n=document.getElementsByTagName("script");return n[n.length-1]}();const t=function(){const n=e.src;let t;try{const e=new URL(n);t=new URLSearchParams(e.search)}catch(n){t=new URLSearchParams("")}let o=null;const a=t.get("customTechs");if(a)try{o=JSON.parse(decodeURIComponent(a))}catch(n){console.warn("‚ö†Ô∏è Space Invaders: invalid customTechs JSON, using defaults")}return{autoStart:"true"===t.get("autoStart"),shooterIcon:t.get("shooterIcon")||"‚ñ≤",invaderImage:t.get("invaderImage")||"",bgColor:t.get("bgColor")||"transparent",fontColor:t.get("fontColor")||"white",difficulty:t.get("difficulty")||"medium",showTechTable:"false"!==t.get("showTechTable"),showPrompt:"false"!==t.get("showPrompt"),customTechs:o}}();console.log("‚öôÔ∏è Space Invaders Config:",t);const o=t.customTechs||[{name:"React",icon:"‚öõÔ∏è",pointsNeeded:5},{name:"Node.js",icon:"üü¢",pointsNeeded:10},{name:"Python",icon:"üêç",pointsNeeded:15},{name:"Vue",icon:"üíö",pointsNeeded:20},{name:"TypeScript",icon:"üî∑",pointsNeeded:25},{name:"AI/ML",icon:"ü§ñ",pointsNeeded:30},{name:"PostgreSQL",icon:"üêò",pointsNeeded:35},{name:"AWS",icon:"‚òÅÔ∏è",pointsNeeded:40}],a={easy:{invaderSpeed:.4,bulletSpeed:7,invaderBulletSpeed:2,fireRate:120,waveSize:12},medium:{invaderSpeed:.7,bulletSpeed:6,invaderBulletSpeed:3,fireRate:80,waveSize:18},hard:{invaderSpeed:1.1,bulletSpeed:5,invaderBulletSpeed:4,fireRate:50,waveSize:24}},i=a[t.difficulty]||a.medium;let r=0,s=new Set,c=!1,l=!1,d=null,p=null,m=null,u=null,v=null,f=[],h=[],g=[],x=[],y=0,b=0,w=1,C=0,S=!1;async function E(){try{if(window.AnavoLicenseManager)return null;const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/clonegarden/squarespaceplugins@latest/_shared/licensing.min.js",await new Promise((n,t)=>{e.onload=n,e.onerror=t,document.head.appendChild(e)});const t=new window.AnavoLicenseManager("SpaceInvaders",n,{licenseServer:"https://cdn.jsdelivr.net/gh/clonegarden/squarespaceplugins@latest/_shared/licenses.json",showUI:!1});return await t.init(),t.isLicensed||function(){const n=document.createElement("div");n.className="anavo-watermark-game",n.innerHTML='‚ö†Ô∏è Unlicensed Version ‚Ä¢ <a href="https://anavotech.com/plugins/space-invaders" target="_blank" rel="noopener noreferrer">Get License</a>',n.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: rgba(255, 255, 255, 0.9);\n      padding: 10px 20px;\n      border: 2px solid black;\n      font-family: 'Syne Mono', monospace;\n      font-size: 12px;\n      z-index: 999999;\n      pointer-events: auto;\n    ",document.body.appendChild(n)}(),t}catch(n){return console.warn("‚ö†Ô∏è License check failed:",n.message),null}}function I(){if(p)return;!function(){if(document.getElementById("anavo-space-invaders-styles"))return;const n=document.createElement("style");n.id="anavo-space-invaders-styles",n.textContent=`\n      #anavo-space-invaders-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 999990;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        font-family: 'Syne Mono', 'Courier New', monospace;\n        background: ${"transparent"===t.bgColor?"rgba(0,0,0,0.85)":"#"+t.bgColor.replace("#","")};\n        color: ${t.fontColor};\n        overflow: hidden;\n      }\n\n      #anavo-space-invaders-overlay * {\n        box-sizing: border-box;\n      }\n\n      #anavo-si-canvas {\n        display: block;\n        cursor: none;\n        touch-action: none;\n        max-width: 100%;\n      }\n\n      #anavo-si-hud {\n        position: absolute;\n        top: 12px;\n        left: 0;\n        width: 100%;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 0 20px;\n        font-size: 14px;\n        color: ${t.fontColor};\n        pointer-events: none;\n        z-index: 1;\n      }\n\n      #anavo-si-close {\n        position: absolute;\n        top: 10px;\n        right: 16px;\n        background: none;\n        border: 1px solid ${t.fontColor};\n        color: ${t.fontColor};\n        font-size: 18px;\n        width: 32px;\n        height: 32px;\n        cursor: pointer;\n        z-index: 2;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-family: 'Syne Mono', monospace;\n        opacity: 0.7;\n        transition: opacity 0.2s;\n      }\n\n      #anavo-si-close:hover {\n        opacity: 1;\n      }\n\n      #anavo-si-prompt {\n        text-align: center;\n        padding: 40px 20px;\n      }\n\n      #anavo-si-prompt h2 {\n        font-size: clamp(22px, 4vw, 36px);\n        margin-bottom: 12px;\n        font-family: 'Syne Mono', monospace;\n        color: ${t.fontColor};\n      }\n\n      #anavo-si-prompt p {\n        font-size: clamp(13px, 2vw, 16px);\n        opacity: 0.8;\n        margin-bottom: 24px;\n        color: ${t.fontColor};\n      }\n\n      #anavo-si-prompt-start {\n        background: ${t.fontColor};\n        color: ${"transparent"===t.bgColor?"#000":"#"+t.bgColor.replace("#","")};\n        border: none;\n        padding: 14px 36px;\n        font-size: 16px;\n        font-family: 'Syne Mono', monospace;\n        cursor: pointer;\n        margin-right: 12px;\n        transition: transform 0.15s;\n      }\n\n      #anavo-si-prompt-start:hover {\n        transform: scale(1.05);\n      }\n\n      #anavo-si-prompt-skip {\n        background: none;\n        color: ${t.fontColor};\n        border: 1px solid ${t.fontColor};\n        padding: 14px 36px;\n        font-size: 16px;\n        font-family: 'Syne Mono', monospace;\n        cursor: pointer;\n        opacity: 0.6;\n        transition: opacity 0.15s;\n      }\n\n      #anavo-si-prompt-skip:hover {\n        opacity: 1;\n      }\n\n      #anavo-si-tech-table {\n        margin-top: 28px;\n        width: 100%;\n        max-width: 480px;\n      }\n\n      #anavo-si-tech-table h3 {\n        font-size: 13px;\n        margin-bottom: 10px;\n        opacity: 0.7;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        color: ${t.fontColor};\n      }\n\n      .anavo-si-badges {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        justify-content: center;\n      }\n\n      .anavo-si-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 5px 12px;\n        border: 1px solid ${t.fontColor};\n        font-size: 12px;\n        font-family: 'Syne Mono', monospace;\n        color: ${t.fontColor};\n        opacity: 0.3;\n        transition: opacity 0.3s, background 0.3s;\n        border-radius: 3px;\n      }\n\n      .anavo-si-badge.unlocked {\n        opacity: 1;\n        background: rgba(255,255,255,0.1);\n      }\n\n      #anavo-si-gameover {\n        text-align: center;\n        padding: 40px 20px;\n        animation: anavo-si-fadein 0.4s ease;\n      }\n\n      #anavo-si-gameover h2 {\n        font-size: clamp(24px, 5vw, 42px);\n        margin-bottom: 12px;\n        font-family: 'Syne Mono', monospace;\n        color: ${t.fontColor};\n      }\n\n      #anavo-si-gameover p {\n        font-size: 16px;\n        opacity: 0.8;\n        margin-bottom: 8px;\n        color: ${t.fontColor};\n      }\n\n      #anavo-si-gameover .anavo-si-badges {\n        margin: 20px auto;\n        max-width: 400px;\n      }\n\n      #anavo-si-gameover-btns {\n        margin-top: 24px;\n        display: flex;\n        gap: 12px;\n        justify-content: center;\n        flex-wrap: wrap;\n      }\n\n      #anavo-si-gameover-btns button {\n        padding: 12px 28px;\n        font-size: 15px;\n        font-family: 'Syne Mono', monospace;\n        cursor: pointer;\n        transition: transform 0.15s;\n      }\n\n      #anavo-si-gameover-btns button:hover {\n        transform: scale(1.05);\n      }\n\n      .anavo-si-btn-primary {\n        background: ${t.fontColor};\n        color: #000;\n        border: none;\n      }\n\n      .anavo-si-btn-secondary {\n        background: none;\n        color: ${t.fontColor};\n        border: 1px solid ${t.fontColor};\n        opacity: 0.7;\n      }\n\n      @keyframes anavo-si-fadein {\n        from { opacity: 0; transform: translateY(20px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n\n      @media (max-width: 600px) {\n        #anavo-si-hud { font-size: 12px; }\n        .anavo-si-badge { font-size: 11px; padding: 4px 8px; }\n      }\n\n      @media (prefers-reduced-motion: reduce) {\n        .anavo-si-badge, #anavo-si-prompt-start, #anavo-si-prompt-skip {\n          transition: none;\n        }\n      }\n    `,document.head.appendChild(n)}(),p=document.createElement("div"),p.id="anavo-space-invaders-overlay",p.setAttribute("role","dialog"),p.setAttribute("aria-label","Space Invaders Game"),p.setAttribute("aria-modal","true");const n=document.createElement("button");n.id="anavo-si-close",n.textContent="‚úï",n.setAttribute("aria-label","Close game"),n.addEventListener("click",W),p.appendChild(n),document.body.appendChild(p)}function M(){p||I(),Array.from(p.children).forEach(n=>{"anavo-si-close"!==n.id&&p.removeChild(n)});const n=document.createElement("div");n.id="anavo-si-prompt",n.innerHTML="\n      <h2>üéÆ Space Invaders</h2>\n      <p>Move your mouse to aim ¬∑ Click to shoot ¬∑ Unlock tech badges!</p>\n    ";const e=document.createElement("div"),a=document.createElement("button");a.id="anavo-si-prompt-start",a.textContent="üöÄ Play Now",a.addEventListener("click",G);const i=document.createElement("button");i.id="anavo-si-prompt-skip",i.textContent="Skip",i.addEventListener("click",W),e.appendChild(a),e.appendChild(i),n.appendChild(e),t.showTechTable&&n.appendChild(function(n){const e=document.createElement("div");e.id=n||"anavo-si-tech-table";const t=document.createElement("h3");t.textContent="Tech Badges",e.appendChild(t);const a=document.createElement("div");return a.className="anavo-si-badges",o.forEach(n=>{const e=document.createElement("span");e.className="anavo-si-badge",e.id=`anavo-si-badge-${n.name.replace(/[^a-z0-9]/gi,"_")}`,e.setAttribute("aria-label",`${n.name} badge - ${n.pointsNeeded} points needed`),e.textContent=`${n.icon} ${n.name}`,a.appendChild(e)}),e.appendChild(a),e}("anavo-si-tech-table")),p.appendChild(n),p.style.display="flex",p.appendChild(p.querySelector("#anavo-si-close"))}function $(){if(T(),!p)return;Array.from(p.children).forEach(n=>{"anavo-si-close"!==n.id&&p.removeChild(n)});const n=document.createElement("div");n.id="anavo-si-gameover";const e=document.createElement("h2");e.textContent=l?"üíÄ Game Over":"üèÜ Wave Cleared!",n.appendChild(e);const t=document.createElement("p");t.textContent=`Score: ${r}`,n.appendChild(t);const a=document.createElement("p");if(a.textContent=`Badges unlocked: ${s.size} / ${o.length}`,n.appendChild(a),s.size>0){const e=document.createElement("div");e.className="anavo-si-badges",s.forEach(n=>{const t=o.find(e=>e.name===n);if(t){const n=document.createElement("span");n.className="anavo-si-badge unlocked",n.textContent=`${t.icon} ${t.name}`,e.appendChild(n)}}),n.appendChild(e)}const i=document.createElement("div");i.id="anavo-si-gameover-btns";const c=document.createElement("button");c.className="anavo-si-btn-primary",c.textContent="üîÑ Play Again",c.addEventListener("click",X),i.appendChild(c);const d=document.createElement("button");d.className="anavo-si-btn-secondary",d.textContent="Close",d.addEventListener("click",W),i.appendChild(d),n.appendChild(i),p.appendChild(n),p.appendChild(p.querySelector("#anavo-si-close"))}function L(){return{w:Math.min(window.innerWidth,900),h:Math.min(.85*window.innerHeight,600)}}function k(){const n=L();m&&(m.width=n.w,m.height=n.h),r=0,s=new Set,h=[],g=[],x=[],b=0,l=!1,S=!1,C=(m?m.width:n.w)/2,v={x:n.w/2,y:n.h-36,w:28,h:28,speed:6},function(){y++,f=[],w=1;const n=Math.ceil(Math.sqrt(i.waveSize)),e=Math.ceil(i.waveSize/n),t=m.width/(n+1);for(let o=0;o<e;o++)for(let e=0;e<n&&!(f.length>=i.waveSize);e++)f.push({x:t*(e+1),y:60+50*o,w:28,h:28,alive:!0})}()}function z(n,e){const o=[],a=[t.fontColor,"#ff6600","#ffcc00","#ff4444"];for(let t=0;t<12;t++){const i=2*Math.PI*t/12,r=1.5+2*Math.random();o.push({x:n,y:e,vx:Math.cos(i)*r,vy:Math.sin(i)*r,r:2+2*Math.random(),alpha:1,color:a[Math.floor(Math.random()*a.length)]})}x.push({particles:o,life:30})}function N(){h.push({x:v.x,y:v.y-v.h/2,vy:-i.bulletSpeed})}function A(){if(!c)return;const n=m.width,e=m.height;u.clearRect(0,0,n,e),b++;const a=Math.max(v.w/2,Math.min(n-v.w/2,C));v.x+=.2*(a-v.x),h=h.filter(n=>(n.y+=n.vy,n.y>0)),g=g.filter(n=>(n.y+=n.vy,n.y<e));const p=f.filter(n=>n.alive);if(0===p.length)return l=!1,void $();let E=!1;if(p.forEach(e=>{e.x+=i.invaderSpeed*w*(1+.05*y),(e.x>=n-e.w/2||e.x<=e.w/2)&&(E=!0)}),E&&(w*=-1,p.forEach(n=>{n.y+=18})),p.some(n=>n.y>=e-v.h-10))return l=!0,void $();S&&b%18==0&&N(),b%i.fireRate===0&&function(){const n=f.filter(n=>n.alive);if(0===n.length)return;const e=n[Math.floor(Math.random()*n.length)];g.push({x:e.x,y:e.y+e.h/2,vy:i.invaderBulletSpeed})}(),h.forEach(n=>{p.forEach(e=>{e.alive&&Math.abs(n.x-e.x)<e.w/2+3&&Math.abs(n.y-e.y)<e.h/2+3&&(e.alive=!1,n.y=-999,r+=1,z(e.x,e.y),o.forEach(n=>{if(!s.has(n.name)&&r>=n.pointsNeeded){s.add(n.name);const e=document.getElementById(`anavo-si-badge-${n.name.replace(/[^a-z0-9]/gi,"_")}`);e&&e.classList.add("unlocked"),console.log(`üèÜ Badge unlocked: ${n.icon} ${n.name}`)}}))})}),g.forEach(n=>{if(Math.abs(n.x-v.x)<v.w/2+3&&Math.abs(n.y-v.y)<v.h/2+3)return l=!0,z(v.x,v.y),void $()}),x=x.filter(n=>(n.life--,n.particles.forEach(n=>{n.x+=n.vx,n.y+=n.vy,n.alpha-=1/30}),n.life>0)),u.save(),u.fillStyle=t.fontColor,u.font=`${v.w}px monospace`,u.textAlign="center",u.textBaseline="middle",u.fillText(t.shooterIcon,v.x,v.y),u.restore(),f.forEach(n=>{n.alive&&(u.save(),t.invaderImage&&window._anavoInvaderImg&&window._anavoInvaderImg.complete?u.drawImage(window._anavoInvaderImg,n.x-n.w/2,n.y-n.h/2,n.w,n.h):(u.fillStyle=t.fontColor,u.font=`${n.w}px monospace`,u.textAlign="center",u.textBaseline="middle",u.fillText("üëæ",n.x,n.y)),u.restore())}),h.forEach(n=>{u.save(),u.fillStyle=t.fontColor,u.beginPath(),u.arc(n.x,n.y,3,0,2*Math.PI),u.fill(),u.restore()}),g.forEach(n=>{u.save(),u.fillStyle="#ff4444",u.beginPath(),u.arc(n.x,n.y,3,0,2*Math.PI),u.fill(),u.restore()}),x.forEach(n=>{n.particles.forEach(n=>{u.save(),u.globalAlpha=n.alpha,u.fillStyle=n.color,u.beginPath(),u.arc(n.x,n.y,n.r,0,2*Math.PI),u.fill(),u.restore()})}),u.save(),u.fillStyle=t.fontColor,u.font="14px monospace",u.textAlign="left",u.textBaseline="top",u.fillText(`Score: ${r}`,12,10),u.textAlign="right",u.fillText(`Wave: ${y}`,m.width-12,10),u.restore(),d=requestAnimationFrame(A)}function T(){c=!1,d&&(cancelAnimationFrame(d),d=null)}function P(n){const e=m?m.getBoundingClientRect():null;C=e?n.clientX-e.left:n.clientX}function B(n){0===n.button&&(S=!0,N())}function R(n){0===n.button&&(S=!1)}function _(n){n.preventDefault();const e=m?m.getBoundingClientRect():null,t=n.touches[0];C=e?t.clientX-e.left:t.clientX,S=!0}function j(){S=!1}function q(){m&&(m.removeEventListener("mousemove",P),m.removeEventListener("mousedown",B),m.removeEventListener("mouseup",R),m.removeEventListener("touchmove",_),m.removeEventListener("touchend",j))}let U=null;function O(){c&&(clearTimeout(U),U=setTimeout(()=>{},300))}function G(){if(c)return;p||I(),Array.from(p.children).forEach(n=>{"anavo-si-close"!==n.id&&p.removeChild(n)});const n=document.createElement("div");n.id="anavo-si-hud",p.appendChild(n);const e=function(){const n=L();return m=document.createElement("canvas"),m.id="anavo-si-canvas",m.width=n.w,m.height=n.h,m.setAttribute("aria-hidden","true"),u=m.getContext("2d"),m}();p.appendChild(e),p.appendChild(p.querySelector("#anavo-si-close")),p.style.display="flex",t.invaderImage&&!window._anavoInvaderImg&&(window._anavoInvaderImg=new Image,window._anavoInvaderImg.src=t.invaderImage),k(),m&&(m.addEventListener("mousemove",P),m.addEventListener("mousedown",B),m.addEventListener("mouseup",R),m.addEventListener("touchmove",_,{passive:!1}),m.addEventListener("touchend",j)),c=!0,A()}function W(){T(),q(),p&&(p.style.display="none")}function X(){T(),q(),G()}window.SpaceInvadersGame={start:G,skip:W,reset:X,cleanup:function(){T(),q(),p&&p.parentNode&&(p.parentNode.removeChild(p),p=null);const n=document.getElementById("anavo-space-invaders-styles");n&&n.parentNode&&n.parentNode.removeChild(n),m=null,u=null},getScore:()=>r,getBadges:()=>Array.from(s)},async function(){window.addEventListener("scroll",O,{passive:!0}),E().catch(()=>{}),t.autoStart?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",G):G():t.showPrompt&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",M):M()),console.log(`‚úÖ Space Invaders Plugin v${n} - Ready`)}()}();